// Generated by CoffeeScript 1.8.0
(function() {
  var Base, httpProxy, oldCreateServer;

  httpProxy = require('http-proxy');

  Base = require('../auth/base');

  oldCreateServer = httpProxy.createServer;

  httpProxy.createServer = function() {
    var authentication, oldProxyRequest, server;
    if (arguments[0] instanceof Base) {
      authentication = arguments[0];
      authentication.proxy = true;
      delete arguments[0];
    }
    server = oldCreateServer.apply(httpProxy, arguments);
    if (authentication) {
      oldProxyRequest = server.proxy.proxyRequest;
      server.proxy.proxyRequest = function(req, res) {
        var externalArguments;
        externalArguments = arguments;
        return authentication.check(req, res, function() {
          return oldProxyRequest.apply(server.proxy, externalArguments);
        });
      };
    }
    return server;
  };

}).call(this);
